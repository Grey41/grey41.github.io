<!DOCTYPE html>
  	<head>
		<script async src = "https://www.googletagmanager.com/gtag/js?id=G-W2C6ZR2P0X"></script>

    	<meta charset = utf-8>
		<meta name = viewport content = "width = device-width, initial-scale = 1">
		<link rel = stylesheet href = css/main.css>

		<script src = https://cdnjs.cloudflare.com/ajax/libs/ace/1.4.12/ace.js type = application/javascript charset = utf-8></script>
		<script src = https://kit.fontawesome.com/1dc9aa0b49.js  crossorigin = anonymous></script>
		<script src = js/main.js></script>
		<script src = js/analytics.js></script>
	
		<title>Wave Simulation</title>
  	</head>
  
  	<body>
		<section class = top>
			<a href = index.html>HOME</a>
			<a href = projects.html>PROJECTS</a>
			<a href = demos.html class = this>DEMOS</a>
			<a href = https://jobase.org target = _blank>JOBASE</a>
			<a href = "https://www.paypal.com/donate?hosted_button_id=CJN2XWS3NTJXL" target = _blank>DONATE</a>
			<a class = icon onclick = bar()><i class = "fa fa-bars"></i></a>
		</section>

		<section class = main>
			<a href = mailto:info@greyhope.uk class = email>info@greyhope.uk</a>

			<h2>Wave Simulation</h2>

			<iframe class = iframe></iframe>
			<div class = editor>
				<xmp>
<!DOCTYPE html>
	<body>
		<canvas id = canvas></canvas>

		<script>
			const RESOLUTION = 200
			const DAMPING = 0.99
			const SPREAD = 0.5
			const SPRING = 0.1

			function resize() {
				// empty the list of waves
				points.length = 0

				// set canvas dimentions
				canvas.width = innerWidth
				canvas.height = innerHeight

				// position all the wave segments
				for (let i = 0; i < RESOLUTION; i ++)
					points.push({height: Math.random() * 0.2 - 0.1, speed: 0})
			}

			function loop() {
				// clear screen
				canvas.width = canvas.width
				
				points.forEach((point, index) => {
					// change speed based on sections on either side
					point.speed += (points[index == 0 ? RESOLUTION - 1 : index - 1].height - point.height) * SPREAD
					point.speed += (points[index == RESOLUTION - 1 ? 0 : index + 1].height - point.height) * SPREAD

					// make the wave move towards the centre
					point.speed += -point.height * SPRING

					// slow the wave down, this makes the splash slowly fade away
					point.speed *= DAMPING
				})

				points.forEach((point, index) => {
					// smooth out all the bumps
					point.height += (points[index == 0 ? RESOLUTION - 1 : index - 1].height - point.height) * 0.1
					point.height += (points[index == RESOLUTION - 1 ? 0 : index + 1].height - point.height) * 0.1
				})

				// starting coordinate of the shape (left, bottom)
				context.moveTo(0, innerHeight)

				points.forEach((point, index) => {
					// update height of the section
					point.height += point.speed

					// mark position on the screen
					context.lineTo(
						index * innerWidth / (RESOLUTION - 1),
						innerHeight / 2 - point.height * innerHeight / 2
					)
				})

				// end coordinate of the shape (right, bottom)
				context.lineTo(innerWidth, innerHeight)

				// set outline width
				context.lineWidth = 5

				// draw the outline
				context.strokeStyle = "#569"
				context.stroke()

				// fill in the shape
				context.fillStyle = "#9ab"
				context.fill()

				requestAnimationFrame(loop)
			}

			function start() {
				// style the body and get rid of margins
				with (document.body.style) {
					margin = 0
					overflow = "hidden"
					background = "#555"
				}

				// when screen resizes, run the resize function
				addEventListener("resize", resize)
				resize()

				// when the mouse clicks on screen, make a wave
				addEventListener("mousedown", event => {
					points[Math.round(event.offsetX / innerWidth * RESOLUTION)].speed = -0.5
				})

				// activate game loop
				loop()
			}

			const context = canvas.getContext("2d")
			const points = []

			start()
		</script>
	</body>
</html>
				</xmp>
			</div>

			<p>
				Even though this demo may seem overwhelming, the concept is quite simple.
				If you lower the <mark>RESOLUTION</mark> value, you will notice that the waves are made of hundreds of sections.
			</p>

			<p>
				Each wave section has its own speed and height that is affected by the sections either side of it.
			</p>

			<iframe class = demo>
<!DOCTYPE html>
	<body>
		<canvas id = canvas></canvas>

		<script>
			const RESOLUTION = 50
			const DAMPING = 0.99
			const SPREAD = 0.1
			const SPRING = 0.01

			function resize() {
				points.length = 0

				canvas.width = innerWidth
				canvas.height = innerHeight

				for (let i = 0; i < RESOLUTION; i ++)
					points.push({height: Math.random() * 0.2 - 0.1, speed: 0})
			}

			function loop() {
				canvas.width = canvas.width
				context.lineWidth = 2
				
				points.forEach((point, index) => {
					point.speed += (points[index == 0 ? RESOLUTION - 1 : index - 1].height - point.height) * SPREAD
					point.speed += (points[index == RESOLUTION - 1 ? 0 : index + 1].height - point.height) * SPREAD
					point.speed += -point.height * SPRING
					point.speed *= DAMPING
				})

				points.forEach((point, index) => {
					point.height += (points[index == 0 ? RESOLUTION - 1 : index - 1].height - point.height) * 0.1
					point.height += (points[index == RESOLUTION - 1 ? 0 : index + 1].height - point.height) * 0.1
				})

				points.forEach((point, index) => {
					point.height += point.speed

					const x = index * innerWidth / (RESOLUTION - 1)
					const y = innerHeight / 2 - point.height * innerHeight / 2

					context.fillStyle = "#f00"
					context.beginPath()
					context.moveTo(x, y)
					context.lineTo(x, innerHeight)
					context.stroke()

					context.fillStyle = "#a00"
					context.fillRect(x - 5, y - 5, 10, 10)
				})

				requestAnimationFrame(loop)
			}

			function start() {
				with (document.body.style) {
					margin = 0
					overflow = "hidden"
					background = "#9ab"
				}

				addEventListener("resize", resize)
				resize()

				addEventListener("mousedown", event => {
					points[Math.round(event.offsetX / innerWidth * RESOLUTION)].speed = -0.5
				})

				loop()
			}

			const context = canvas.getContext("2d")
			const points = []

			start()
		</script>
	</body>
</html>
			</iframe>

			<p>
				To take this demo a step further, you could try to add proper splashes.
				This wave feature is very useful for simulating water without using particles.
			</p>

			<footer></footer>
		</section>
  	</body>
</html>