<!DOCTYPE html>
<html>
    <head>
        <!-- Global site tag (gtag.js) - Google Analytics -->
        <script async src = "https://www.googletagmanager.com/gtag/js?id=G-C34XCNZ9G4"></script>
        <script src = https://cdnjs.cloudflare.com/ajax/libs/ace/1.4.12/ace.js type = application/javascript charset = utf-8></script>
        <script src = https://kit.fontawesome.com/1dc9aa0b49.js crossorigin = anonymous></script>
        <script src = js/main.js></script>

        <meta charset = utf-8>
        <meta name = viewport content = "width = device-width, initial-scale = 1.0">

        <link rel = stylesheet href = css/main.css>
        <title>GreyHope · Chat App · Socket Communication</title>

        <script type = application/ld+json>
            {
                "@context": "https://schema.org",
                "@type": "BreadcrumbList",

                "itemListElement": [{
                    "@type": "ListItem",
                    "position": 1,
                    "name": "Tutorials",
                    "item": "https://greyhope.uk/tutorials.html"
                }, {
                    "@type": "ListItem",
                    "position": 2,
                    "name": "Chat App",
                    "item": "https://greyhope.uk/chat_1.html"
                }, {
                    "@type": "ListItem",
                    "position": 3,
                    "name": "Socket Communication"
                }]
            }
        </script>
    </head>

    <body>
        <section class = top>
            <a href = index.html>HOME</a>
            <a href = demos.html>DEMOS</a>
            <a href = tutorials.html class = this>TUTORIALS</a>
            <a href = https://jobase.org target = _blank>JOBASE</a>
            <a href = https://www.js-bytebase.com target = _blank>JS-BYTEBASE</a>
            <a onclick = bar()><i class = "fa fa-bars"></i></a>
        </section>

        <section class = main>
            <h2>Chat App <a href = tutorials/chat_4.zip download><button title = "Download source files for this page"><i class = "fas fa-download"></i>Download</button></a></h2>

            <a href = chat_3.html><button><i class = "fas fa-arrow-left"></i>Back</button></a>
            <a href = chat_5.html><button class = right>Next<i class = "fas fa-arrow-right"></i></button></a>

            <h3>4. Socket Communication</h3>

            <p>
                On this page we will start writing the <mark>Socket.IO</mark> code.
                This code is important for communicating between the browser and the server.
            </p>

            <p>
                At the top of your page, link to the <mark>Socket.IO</mark> library.
            </p>

            <div class = snippet></div>

            <p>
                Now in the <mark>body</mark> of our code, let's initialise <mark>Socket.IO</mark> in <mark>JavaScript</mark>.
            </p>

            <div class = snippet></div>

            <p>
                We want to detect when the user submits their message.
                The code below uses the <mark>addEventListener</mark> function to detect when this happens.
                Inside the function, we write <mark>preventDefault</mark> to stop the program from automatically switching to a new page.
                Then we print the message to the console.
            </p>

            <div class = snippet></div>

            <p>
                Go to your application and refresh the page.
                Whenever you submit something in the message box, the message is printed to the <mark>Web Console</mark>.
            </p>

            <p>
                We actually want the message to be sent to the server every time the user submits.
                This means we need to use the <mark>Socket.IO emit</mark> function which emits a message to the server.
            </p>

            <div class = snippet></div>

            <p>
                In the example above, we put two values into the <mark>emit</mark> function.
                The first value, <mark>"message"</mark> is a name given to the data you are sending.
                You can change this value based on the kind of data you are sending.
                For example, if you are sending someones age, you would probably want to change this value to <mark>"age"</mark>.
                The second value is the actual data.
                In this case, it's the message submitted by the user.
            </p>

            <p>
                The code above won't do anything because the server isn't recieving this information.
                Let's put our <mark>index.html</mark> to the side and focus on our server code.
                Open the <mark>server.js</mark> file and write the following code.
            </p>

            <div class = snippet></div>

            <p>
                The code above detects when a user connects to your app and then prints <mark>client connected</mark> to the terminal.
                Because we are writing server code, the program currently running in the terminal needs to be refreshed.
                You can do this by holding <mark>Ctrl + C</mark> to cancel the program.
                Then type the following into the terminal.
            </p>

            <pre>node server.js</pre>

            <p>
                Now whenever you visit <mark>localhost:5000</mark>, the terminal will print <mark>client connected</mark>.
            </p>

            <p>
                To recieve our message that we set up in <mark>index.html</mark>, we need to listen for it using the <mark>Socket.IO on</mark> function.
            </p>

            <div class = snippet></div>

            <p>
                The code above tells the server to listen for a signal called <mark>message</mark> and then print the data.
                Refresh your program from the terminal and type a message in the <mark>localhost:5000</mark> input box.
                Whenever you submit a message, it gets printed to the terminal.
                Congratulations! You have managed to implement basic client to server communication.
            </p>

            <p>
                Instead of printing to the terminal, we want the server to send the message to everyone else.
                In your <mark>server.js</mark> file, change the <mark>console.log</mark> command with the following line of code.
            </p>

            <div class = snippet></div>

            <p>
                The code above broadcasts the message to all the clients.
                In our client code, we will recieve the message and display it on the screen.
                Open your <mark>index.html</mark> file and write the following code.
            </p>

            <div class = snippet></div>

            <p>
                Whenever you submit a message at <mark>localhost:5000</mark>, it gets printed to the <mark>Web Console</mark>.
                Although this may not seem very interesting, you can open multiple tabs and check the result.
                When you type a message in one of the browser tabs, it gets printed to all the other consoles!
            </p>

            <p>
                Now we want to display the message in our grey box.
                The code below creates <mark>HTML</mark> divs with the message inside and adds them to our <mark>main div</mark>.
            </p>

            <div class = snippet></div>

            <p>
                Now instead of getting printed to the <mark>Web Console</mark>, all the messages get displayed on the screen.
            </p>

            <p>
                Finally, let's remove the test message and clear the input box every time a user submits.
            </p>

            <div class = snippet></div>

            <p>
                The application is complete.
                If you ever wanted to change the code slightly then now is the time.
                The next page will explain how to publish your app online.
            </p>

            <p>
                <a href = chat_3.html><button><i class = "fas fa-arrow-left"></i>Back</button></a>
                <a href = chat_5.html><button class = right>Next<i class = "fas fa-arrow-right"></i></button></a>
            </p>
        </section>

        <script>
            const snippets = document.querySelectorAll(".snippet")

            snippet("chat_socket_1", snippets[0], 1, [5])
            snippet("chat_socket_2", snippets[1], 61, [12, 13, 14])
            snippet("chat_socket_3", snippets[2], 72, [4, 5, 6, 7])
            snippet("chat_socket_4", snippets[3], 72, [6])
            snippet("chat_socket_5", snippets[4], 6, [4, 5, 6])
            snippet("chat_socket_6", snippets[5], 9, [4, 5, 6])
            snippet("chat_socket_7", snippets[6], 9, [5])
            snippet("chat_socket_8", snippets[7], 72, [9, 10, 11])
            snippet("chat_socket_9", snippets[8], 75, [7, 8, 9, 10, 11, 12, 13, 14])
            snippet("chat_socket_10", snippets[9], 61, [2, 17])
        </script>
    </body>
</html>